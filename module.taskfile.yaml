# https://taskfile.dev

#Called by the vnbuild system to produce builds for my website
#https://www.vaughnnugent.com/resources/software

# This taskfile performs module-wide build operations, invoked buy vnbuild
# https://www.vaughnnugent.com/resources/software/modules/vnbuild

#this file must be in the git root directory

version: '3'

includes:
  ci:
    taskfile: ci/Taskfile.yaml
    dir: './ci'

tasks:

#called by build pipeline to sync repo
  update:
    cmds:
     - git reset --hard
     - git remote update
     - git pull origin {{ .BRANCH_NAME }} --verify-signatures 

  test:
    desc: 'Builds and runs unit tests for vnbuild CI systems'
    cmds: []

#called by build pipeline to build module
  build:
    cmds:
     - cmd: echo "building module {{ .MODULE_NAME }}"
       silent: true
     - task: ci:build

  publish:
    cmds:
     #git archive in the module directory
     - cmd: git archive --format {{ .ARCHIVE_FILE_FORMAT }} --output {{ .ARCHIVE_FILE_NAME }} HEAD
     - cmd: cd out/ && tar -czf ../gc-online.tgz .

  #called by build pipeline to clean module
  clean:
    ignore_error: true
    cmds:
     #clean solution
     - cmd: '{{ if eq OS "windows" }}powershell rm -Force -Recurse{{else}}rm -rf{{end}} out/' 
     - cmd: '{{ if eq OS "windows" }}powershell rm -Force -Recurse{{else}}rm -rf{{end}} frontend/build/' 


