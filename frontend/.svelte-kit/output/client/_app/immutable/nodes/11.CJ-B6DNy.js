import{s as ce,a as C,o as B,c as E,i as v,n as Y,d as c,b as te,e as h,f as b,k as V,g as N,j as m,x as ne,l as p,I as Q,E as ee,F as me,t as K,v as W,h as he,m as be}from"../chunks/scheduler.DrQRk8ea.js";import{S as de,i as _e,b as A,e as ge,t as H,g as ve,c as O,a as P,m as z,d as G}from"../chunks/index.CcdvbsEI.js";import{g as $e,a as ke}from"../chunks/spread.CgU5AtxT.js";import{R as ye,a as we}from"../chunks/RepoHeader.Dy4KkDTX.js";import{I as Ce,g as ae,i as Ee,a as Ie,h as De,N as Ve,f as Te,n as Se,c as je,b as Le,J as Re}from"../chunks/Issue.bBFUSQy9.js";import{C as pe}from"../chunks/Container.CWcU-xxO.js";import{l as Ne,b as Ae,g as He}from"../chunks/UserHeader.BDCIfTyX.js";import{g as Me}from"../chunks/entry.vAbeKpqR.js";import{A as Ue}from"../chunks/AlertError.Bf6rdsHm.js";const xe=({params:n})=>({repo_naddr:n.repo_naddr}),ut=Object.freeze(Object.defineProperty({__proto__:null,load:xe},Symbol.toStringTag,{value:"Module"}));function ie(n){let t,s,e,l,r='<span class="label-text text-sm">Title</span>',i,a,f,d,o,u,$='<span class="label-textarea text-sm">Description</span>',I,g,T,D,k,M,j,L,F,Z,le,y=n[5]&&n[3].length<10&&oe(),w=n[5]&&n[3].length<10&&fe();function se(_,S){return _[1]?Oe:_[6]?qe:Be}let J=se(n),R=J(n);return{c(){t=h("div"),s=h("div"),e=h("label"),l=h("div"),l.innerHTML=r,i=C(),a=h("input"),f=C(),y&&y.c(),d=C(),o=h("label"),u=h("div"),u.innerHTML=$,I=C(),g=h("textarea"),T=C(),D=h("div"),k=h("div"),M=C(),w&&w.c(),j=C(),L=h("button"),R.c(),this.h()},l(_){t=b(_,"DIV",{class:!0});var S=V(t);s=b(S,"DIV",{class:!0});var U=V(s);e=b(U,"LABEL",{class:!0});var x=V(e);l=b(x,"DIV",{class:!0,"data-svelte-h":!0}),N(l)!=="svelte-245z59"&&(l.innerHTML=r),i=E(x),a=b(x,"INPUT",{type:!0,class:!0,placeholder:!0}),f=E(x),y&&y.l(x),x.forEach(c),d=E(U),o=b(U,"LABEL",{class:!0});var X=V(o);u=b(X,"DIV",{class:!0,"data-svelte-h":!0}),N(u)!=="svelte-1j073h6"&&(u.innerHTML=$),I=E(X),g=b(X,"TEXTAREA",{class:!0,placeholder:!0,rows:!0}),V(g).forEach(c),X.forEach(c),T=E(U),D=b(U,"DIV",{class:!0});var q=V(D);k=b(q,"DIV",{class:!0}),V(k).forEach(c),M=E(q),w&&w.l(q),j=E(q),L=b(q,"BUTTON",{class:!0});var re=V(L);R.l(re),re.forEach(c),q.forEach(c),U.forEach(c),S.forEach(c),this.h()},h(){m(l,"class","label"),m(a,"type","text"),m(a,"class","input-neutral input input-sm input-bordered mb-3 w-full border-warning"),m(a,"placeholder","title"),ne(a,"border-warning",n[5]&&n[3].length<10),m(e,"class","form-control w-full"),m(u,"class","label"),g.disabled=n[1],m(g,"class","textarea textarea-secondary w-full"),m(g,"placeholder","description"),m(g,"rows","10"),m(o,"class","form-control w-full"),m(k,"class","flex-auto"),L.disabled=F=n[1]||n[5]&&n[3].length<10,m(L,"class","btn btn-primary btn-sm"),m(D,"class","mt-2 flex items-center"),m(s,"class","flex-grow"),m(t,"class","flex")},m(_,S){v(_,t,S),p(t,s),p(s,e),p(e,l),p(e,i),p(e,a),Q(a,n[3]),p(e,f),y&&y.m(e,null),p(s,d),p(s,o),p(o,u),p(o,I),p(o,g),Q(g,n[4]),p(s,T),p(s,D),p(D,k),p(D,M),w&&w.m(D,null),p(D,j),p(D,L),R.m(L,null),Z||(le=[ee(a,"input",n[9]),ee(g,"input",n[10]),ee(L,"click",n[11])],Z=!0)},p(_,S){S&8&&a.value!==_[3]&&Q(a,_[3]),S&40&&ne(a,"border-warning",_[5]&&_[3].length<10),_[5]&&_[3].length<10?y||(y=oe(),y.c(),y.m(e,null)):y&&(y.d(1),y=null),S&2&&(g.disabled=_[1]),S&16&&Q(g,_[4]),_[5]&&_[3].length<10?w||(w=fe(),w.c(),w.m(D,j)):w&&(w.d(1),w=null),J!==(J=se(_))&&(R.d(1),R=J(_),R&&(R.c(),R.m(L,null))),S&42&&F!==(F=_[1]||_[5]&&_[3].length<10)&&(L.disabled=F)},d(_){_&&c(t),y&&y.d(),w&&w.d(),R.d(),Z=!1,me(le)}}}function oe(n){let t,s="title must be at least 10 characters";return{c(){t=h("div"),t.textContent=s,this.h()},l(e){t=b(e,"DIV",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-1k9wd8j"&&(t.textContent=s),this.h()},h(){m(t,"class","pr-3 align-middle text-sm text-warning")},m(e,l){v(e,t,l)},d(e){e&&c(t)}}}function fe(n){let t,s="title must be at least 10 characters";return{c(){t=h("div"),t.textContent=s,this.h()},l(e){t=b(e,"DIV",{class:!0,"data-svelte-h":!0}),N(t)!=="svelte-1k9wd8j"&&(t.textContent=s),this.h()},h(){m(t,"class","pr-3 align-middle text-sm text-warning")},m(e,l){v(e,t,l)},d(e){e&&c(t)}}}function qe(n){let t;return{c(){t=K("Send")},l(s){t=W(s,"Send")},m(s,e){v(s,t,e)},d(s){s&&c(t)}}}function Be(n){let t;return{c(){t=K("Login before Sending")},l(s){t=W(s,"Login before Sending")},m(s,e){v(s,t,e)},d(s){s&&c(t)}}}function Oe(n){let t;return{c(){t=K("Sending")},l(s){t=W(s,"Sending")},m(s,e){v(s,t,e)},d(s){s&&c(t)}}}function ue(n){let t,s="sent going to issue!";return{c(){t=h("div"),t.textContent=s},l(e){t=b(e,"DIV",{"data-svelte-h":!0}),N(t)!=="svelte-1brpraj"&&(t.textContent=s)},m(e,l){v(e,t,l)},d(e){e&&c(t)}}}function Pe(n){let t,s,e=n[2]&&ie(n),l=n[0]&&ue();return{c(){e&&e.c(),t=C(),l&&l.c(),s=B()},l(r){e&&e.l(r),t=E(r),l&&l.l(r),s=B()},m(r,i){e&&e.m(r,i),v(r,t,i),l&&l.m(r,i),v(r,s,i)},p(r,[i]){r[2]?e?e.p(r,i):(e=ie(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null),r[0]?l||(l=ue(),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},i:Y,o:Y,d(r){r&&(c(t),c(s)),e&&e.d(r),l&&l.d(r)}}}function ze(n,t,s){let e;te(n,Ne,T=>s(6,e=T));let{repo_event:l}=t,r=!1,i=!1,a=!1,f="",d="",o=!1;async function u(T,D){if(s(5,o=!0),T.length<10||(e||await Ae(),!e))return;let k=new Ce(ae);k.kind=Ee,k.tags.push(["subject",T]),k.tags.push(["alt",`git repository issue: ${T}`]),l.unique_commit&&k.tags.push(["r",l.unique_commit]),k.tags.push(["a",`${Ie}:${l.maintainers[0]}:${l.identifier}`,l.relays[0]||"","root"]),l.maintainers.forEach(j=>k.tags.push(["p",j])),k.content=`${D}`,s(1,r=!0);let M=[...l.relays.length>3?l.relays:[...De].concat(l.relays)];try{k.sign()}catch{alert("failed to sign event")}try{let j=await He(e.hexpubkey);M=[...M,...j.ndk_relays?j.ndk_relays.writeRelayUrls:[]]}catch{alert("failed to get user relays")}try{let j=await k.publish(Ve.fromRelayUrls(M,ae));s(1,r=!1),s(0,i=!0),setTimeout(()=>{Me(`/r/${l.naddr}/issues/${Te.noteEncode(k.id)}`)},2e3)}catch{}}function $(){f=this.value,s(3,f)}function I(){d=this.value,s(4,d)}const g=()=>u(f,d);return n.$$set=T=>{"repo_event"in T&&s(8,l=T.repo_event)},n.$$.update=()=>{n.$$.dirty&1&&s(2,a=!i)},[i,r,a,f,d,o,e,u,l,$,I,g]}class Ge extends de{constructor(t){super(),_e(this,t,ze,Pe,ce,{repo_event:8})}}function Ke(n){let t,s,e,l;const r=[n[3]];let i={};for(let a=0;a<r.length;a+=1)i=be(i,r[a]);return t=new ye({props:i}),e=new pe({props:{$$slots:{default:[Fe]},$$scope:{ctx:n}}}),{c(){O(t.$$.fragment),s=C(),O(e.$$.fragment)},l(a){P(t.$$.fragment,a),s=E(a),P(e.$$.fragment,a)},m(a,f){z(t,a,f),v(a,s,f),z(e,a,f),l=!0},p(a,f){const d=f&8?$e(r,[ke(a[3])]):{};t.$set(d);const o={};f&137&&(o.$$scope={dirty:f,ctx:a}),e.$set(o)},i(a){l||(H(t.$$.fragment,a),H(e.$$.fragment,a),l=!0)},o(a){A(t.$$.fragment,a),A(e.$$.fragment,a),l=!1},d(a){a&&c(s),G(t,a),G(e,a)}}}function We(n){let t,s;return t=new pe({props:{$$slots:{default:[Ye]},$$scope:{ctx:n}}}),{c(){O(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,l){z(t,e,l),s=!0},p(e,l){const r={};l&130&&(r.$$scope={dirty:l,ctx:e}),t.$set(r)},i(e){s||(H(t.$$.fragment,e),s=!0)},o(e){A(t.$$.fragment,e),s=!1},d(e){G(t,e)}}}function Fe(n){let t,s,e,l="Create Issue",r,i,a,f,d,o;return i=new Ge({props:{repo_event:n[3]}}),d=new we({props:{a:n[0]}}),{c(){t=h("div"),s=h("div"),e=h("h4"),e.textContent=l,r=C(),O(i.$$.fragment),a=C(),f=h("div"),O(d.$$.fragment),this.h()},l(u){t=b(u,"DIV",{class:!0});var $=V(t);s=b($,"DIV",{class:!0});var I=V(s);e=b(I,"H4",{"data-svelte-h":!0}),N(e)!=="svelte-1bddlnl"&&(e.textContent=l),r=E(I),P(i.$$.fragment,I),I.forEach(c),a=E($),f=b($,"DIV",{class:!0});var g=V(f);P(d.$$.fragment,g),g.forEach(c),$.forEach(c),this.h()},h(){m(s,"class","prose lg:mr-2 lg:w-2/3"),m(f,"class","prose ml-2 hidden w-1/3 lg:flex"),m(t,"class","mt-2 lg:flex")},m(u,$){v(u,t,$),p(t,s),p(s,e),p(s,r),z(i,s,null),p(t,a),p(t,f),z(d,f,null),o=!0},p(u,$){const I={};$&8&&(I.repo_event=u[3]),i.$set(I);const g={};$&1&&(g.a=u[0]),d.$set(g)},i(u){o||(H(i.$$.fragment,u),H(d.$$.fragment,u),o=!0)},o(u){A(i.$$.fragment,u),A(d.$$.fragment,u),o=!1},d(u){u&&c(t),G(i),G(d)}}}function Je(n){let t,s="Error! cannot find repository event:",e,l,r;return{c(){t=h("div"),t.textContent=s,e=C(),l=h("div"),r=K(n[5]),this.h()},l(i){t=b(i,"DIV",{"data-svelte-h":!0}),N(t)!=="svelte-xcgkfj"&&(t.textContent=s),e=E(i),l=b(i,"DIV",{class:!0});var a=V(l);r=W(a,n[5]),a.forEach(c),this.h()},h(){m(l,"class","break-all")},m(i,a){v(i,t,a),v(i,e,a),v(i,l,a),p(l,r)},p:Y,d(i){i&&(c(t),c(e),c(l))}}}function Xe(n){let t,s="Error! invalid naddr in url:",e,l,r;return{c(){t=h("div"),t.textContent=s,e=C(),l=h("div"),r=K(n[5]),this.h()},l(i){t=b(i,"DIV",{"data-svelte-h":!0}),N(t)!=="svelte-1tdr53x"&&(t.textContent=s),e=E(i),l=b(i,"DIV",{class:!0});var a=V(l);r=W(a,n[5]),a.forEach(c),this.h()},h(){m(l,"class","break-all")},m(i,a){v(i,t,a),v(i,e,a),v(i,l,a),p(l,r)},p:Y,d(i){i&&(c(t),c(e),c(l))}}}function Qe(n){let t;function s(r,i){return r[1]?Xe:Je}let e=s(n),l=e(n);return{c(){l.c(),t=B()},l(r){l.l(r),t=B()},m(r,i){l.m(r,i),v(r,t,i)},p(r,i){e===(e=s(r))&&l?l.p(r,i):(l.d(1),l=e(r),l&&(l.c(),l.m(t.parentNode,t)))},d(r){r&&c(t),l.d(r)}}}function Ye(n){let t,s;return t=new Ue({props:{$$slots:{default:[Qe]},$$scope:{ctx:n}}}),{c(){O(t.$$.fragment)},l(e){P(t.$$.fragment,e)},m(e,l){z(t,e,l),s=!0},p(e,l){const r={};l&130&&(r.$$scope={dirty:l,ctx:e}),t.$set(r)},i(e){s||(H(t.$$.fragment,e),s=!0)},o(e){A(t.$$.fragment,e),s=!1},d(e){G(t,e)}}}function Ze(n){let t,s,e,l,r,i;document.title=t="GitWorkshop: "+n[3].name+" - new issue";const a=[We,Ke],f=[];function d(o,u){return o[1]||o[2]&&o[4].loading&&o[3].name.length?0:1}return e=d(n),l=f[e]=a[e](n),{c(){s=C(),l.c(),r=B()},l(o){he("svelte-8ie5fc",document.head).forEach(c),s=E(o),l.l(o),r=B()},m(o,u){v(o,s,u),f[e].m(o,u),v(o,r,u),i=!0},p(o,[u]){(!i||u&8)&&t!==(t="GitWorkshop: "+o[3].name+" - new issue")&&(document.title=t);let $=e;e=d(o),e===$?f[e].p(o,u):(ve(),A(f[$],1,1,()=>{f[$]=null}),ge(),l=f[e],l?l.p(o,u):(l=f[e]=a[e](o),l.c()),H(l,1),l.m(r.parentNode,r))},i(o){i||(H(l),i=!0)},o(o){A(l),i=!1},d(o){o&&(c(s),c(r)),f[e].d(o)}}}function et(n,t,s){let e,l;te(n,Le,o=>s(3,e=o)),te(n,Re,o=>s(4,l=o));let{data:r}=t,i=r.repo_naddr,a=!1,f="",d=!1;return setTimeout(()=>{s(2,d=!0)},5e3),n.$$set=o=>{"data"in o&&s(6,r=o.data)},n.$$.update=()=>{if(n.$$.dirty&1){const o=Se(i);o?(s(0,f=o),s(1,a=!1),je(f)):s(1,a=!0)}},[f,a,d,e,l,i,r]}class ct extends de{constructor(t){super(),_e(this,t,et,Ze,ce,{data:6})}}export{ct as component,ut as universal};
